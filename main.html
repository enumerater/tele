<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./main.css">

</head>
<body>

    <div class="header">
        <div class="title">
            通讯录
        </div>
        <div class="add">
            <img src="./add.png" alt="">
        </div>
    </div>

    <div class="items"></div>

    <div class="footer">
        <input class="input-name" type="text" placeholder="请输入姓名">
        <input class="input-phone" type="text" placeholder="请输入手机号">
        <button class="add-btn">添加联系人</button>
    </div>


    <script src="./alloy_finger.js"></script>
    <script src="./main.js"></script>
    
</body>
</html>

<script>
    const items = [
        {
            name: '周杰伦',
            phone: '13800000000'
        },
        {
            name: '刘德华',
            phone: '13800000001'
        },
        {
            name: '张学友',
            phone: '13800000002'
        },
        {
            name: '岳云鹏',
            phone: '13800000003'
        }
        
    ]
    const render = () => {
        document.querySelector('.items').innerHTML = ''
        items.forEach(item => {
            const itemDiv = document.createElement('div')
            itemDiv.classList.add('item')
            itemDiv.innerHTML = `
                <div class="pic"></div>
                <div class="name">
                    ${item.name}
                </div>
                <div class="phone">
                    ${item.phone}
                </div>
                <div class="delete">
                    删除
                </div>
            `
            document.querySelector('.items').appendChild(itemDiv)

            const pic = document.querySelectorAll('.pic')
            pic.forEach((item, index) => {
                item.textContent = items[index].name[items[index].name.length - 1]
            })
        })
    }

    
    
    const addBtn = document.querySelector('.add-btn')
    addBtn.addEventListener('click', () => {
        const name = document.querySelector('.input-name').value
        const phone = document.querySelector('.input-phone').value

        if (name === '' || phone === '') {
            alert('请输入姓名和手机号')
            return
        }
        
        items.push({
            name: name,
            phone: phone
        })
        render()
        huadong()
        deleteItem()
    })

    const huadong = () => {
        const elements = document.querySelectorAll('.item')
        elements.forEach(item => {
        var af = new AlloyFinger(item, {
            swipe: function (evt) {
                // 3. 滑动距离改为delete的宽度（60px），确保完全露出
                if (evt.direction === 'Left') {
                    // 让item内部所有元素左移60px，露出删除按钮
                    const children = item.children;
                    for (let i = 0; i < children.length; i++) {
                        children[i].style.transform = 'translateX(-60px)';
                    }

                } else if (evt.direction === 'Right') {
                    // 让item内部所有元素复位
                    const children = item.children;
                    for (let i = 0; i < children.length; i++) {
                        children[i].style.transform = 'translateX(0)';
                    }
                }
            }
        });
        })
    }


    const deleteItem = (index) => {
        const deleteBtn = document.querySelectorAll('.delete')
            deleteBtn.forEach((item, index) => {
                item.addEventListener('click', () => {
                    items.splice(index, 1) // 删除指定元素
                    console.log(items)
                    render()
                    huadong()
                    deleteItem()
                })
            })
    }

    render()
    huadong()
    deleteItem()
    
</script>
